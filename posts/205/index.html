<!doctype html><html lang=en><head><title>s32v编译内核模块 · Hd's Blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="shuiyuehd"><meta name=description content="Hd's personal website"><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="s32v编译内核模块"><meta name=twitter:description content><meta property="og:title" content="s32v编译内核模块"><meta property="og:description" content><meta property="og:type" content="article"><meta property="og:url" content="https://blog.shuiyuehd.cn/posts/205/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-06-28T00:00:00+00:00"><meta property="article:modified_time" content="2017-06-28T00:00:00+00:00"><meta property="og:see_also" content="https://blog.shuiyuehd.cn/posts/206/"><link rel=canonical href=https://blog.shuiyuehd.cn/posts/205/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.c4d7e93a158eda5a65b3df343745d2092a0a1e2170feeec909b8a89443903c6a.css integrity="sha256-xNfpOhWO2lpls980N0XSCSoKHiFw/u7JCbiolEOQPGo=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.78b5fe3864945faf5207fb8fe3ab2320d49c3365def0e88ac1df0ddadc54a03c.css integrity="sha256-eLX+OGSUX69SB/uP46sjINScM2Xe8OiKwd8N2txUoDw=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/css/custom.min.5ee0ad9e8f1b17d7a2309a71c69cb872e2afd31d618222760117de63b651a440.css integrity="sha256-XuCtno8bF9eiMJpxxpy4cuKv0x1hgiJ2ARfeY7ZRpEA=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/custom.min.85f403ff232218bd8e612424d1885bb4d57fd440764fa75faecb6ceb511c75b4.css integrity="sha256-hfQD/yMiGL2OYSQk0YhbtNV/1EB2T6dfrsts61EcdbQ=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5><meta name=generator content="Hugo 0.104.3"></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Hd's Blog</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/about/>About</a></li><li class=navigation-item><a class=navigation-link href=/posts/>Posts</a></li><li class=navigation-item><a class=navigation-link href=/contact/>Contact</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://blog.shuiyuehd.cn/posts/205/>s32v编译内核模块</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2017-06-28T00:00:00Z>2017-06-28</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
2-minute read</span></div><div class=categories><i class="fa fa-folder" aria-hidden=true></i>
<a href=/categories/kernel/>kernel</a></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/kernel/>kernel</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/driver/>driver</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/s32v/>s32v</a></span></div></div></header><div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#6272a4># Build standalone kernel modules</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>ARCH</span><span style=color:#ff79c6>=</span>arm64
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>CROSS_COMPILE</span><span style=color:#ff79c6>=</span>&lt;builddir&gt;/tmp/sysroots/x86_64-linux/usr/bin/aarch64-fsl-linux/aarch64-fsl-linux-
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#8be9fd;font-style:italic>export</span> &lt;Your kernel build&gt;<span style=color:#ff79c6>=</span>&lt;builddir&gt;/tmp/work/&lt;boardtype&gt;-fsl-linux/linux-s32v2xx/4.1.26-r0/build
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>ARCH</span><span style=color:#ff79c6>=</span>arm64
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>CROSS_COMPILE</span><span style=color:#ff79c6>=</span>/home/yocto/hedong/SourceCode/baolong-sourcecode/baolong4_1_26/BSP_12.0/Yocto_s32v234_bsp12.0/build_s32v234evb_release/tmp/sysroots/x86_64-linux/usr/bin/aarch64-fsl-linux/aarch64-fsl-linux-
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>KERNEL_DIR</span><span style=color:#ff79c6>=</span>/home/yocto/hedong/SourceCode/baolong-sourcecode/baolong4_1_26/BSP_12.0/Yocto_s32v234_bsp12.0/build_s32v234evb_release/tmp/work/s32v234evb-fsl-linux/linux-s32v2xx/4.1.26-r0/build
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>TOOLCHAIN</span><span style=color:#ff79c6>=</span>/home/yocto/hedong/SourceCode/baolong-sourcecode/baolong4_1_26/BSP_12.0/Yocto_s32v234_bsp12.0/build_s32v234evb_release/tmp/sysroots/x86_64-linux/usr/bin/aarch64-fsl-linux
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>PATH</span><span style=color:#ff79c6>=</span><span style=color:#8be9fd;font-style:italic>$TOOLCHAIN</span>:<span style=color:#8be9fd;font-style:italic>$PATH</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>LINUX_S32V234_DIR</span><span style=color:#ff79c6>=</span>/home/yocto/hedong/SourceCode/baolong-sourcecode/baolong4_1_26/4.1.26-bsp-12.0_hd/kernel-source
</span></span></code></pre></div><h3 id=编译驱动出错>编译驱动出错
<a class=heading-link href=#%e7%bc%96%e8%af%91%e9%a9%b1%e5%8a%a8%e5%87%ba%e9%94%99><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>root@ubuntu:/home/yocto/hedong/bsp_12_0_s32v/s32v234_sdk/libs/utils/oal/kernel/build-v234ce-gnu-linux-d# make
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>make <span style=color:#8be9fd;font-style:italic>KCPPFLAGS</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;&#34;</span>-O3 -D __KERNEL_MODULE -D __ARMV8 -I /home/yocto/hedong/bsp_12_0_s32v/s32v234_sdk/libs/utils/oal/kernel/build-v234ce-gnu-linux-d/../include/ -I /home/yocto/hedong/bsp_12_0_s32v/s32v234_sdk/libs/utils/oal/kernel/build-v234ce-gnu-linux-d/../../common/include/ -I /home/yocto/hedong/bsp_12_0_s32v/s32v234_sdk/libs/utils/oal/kernel/build-v234ce-gnu-linux-d/../../../../../include/ -I /home/yocto/hedong/SourceCode/baolong-sourcecode/baolong4_1_26/4.1.26-bsp-12.0_hd/kernel-source/arch/arm64/include -I /home/yocto/hedong/SourceCode/baolong-sourcecode/baolong4_1_26/4.1.26-bsp-12.0_hd/kernel-source/arch/arm64/include/generated <span style=color:#f1fa8c>&#34;&#34;</span> <span style=color:#8be9fd;font-style:italic>ARCH</span><span style=color:#ff79c6>=</span>arm64 <span style=color:#8be9fd;font-style:italic>CROSS_COMPILE</span><span style=color:#ff79c6>=</span>/home/yocto/hedong/SourceCode/baolong-sourcecode/baolong4_1_26/BSP_12.0/Yocto_s32v234_bsp12.0/build_s32v234evb_release/tmp/sysroots/x86_64-linux/usr/bin/aarch64-fsl-linux/aarch64-fsl-linux- -C /home/yocto/hedong/SourceCode/baolong-sourcecode/baolong4_1_26/4.1.26-bsp-12.0_hd/kernel-source  <span style=color:#8be9fd;font-style:italic>M</span><span style=color:#ff79c6>=</span>/home/yocto/hedong/bsp_12_0_s32v/s32v234_sdk/libs/utils/oal/kernel/build-v234ce-gnu-linux-d modules 
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>make: invalid option -- <span style=color:#f1fa8c>&#39;D&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>make: invalid option -- <span style=color:#f1fa8c>&#39;D&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>make: *** empty string invalid as file name.  Stop.
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>make: *** <span style=color:#ff79c6>[</span>all<span style=color:#ff79c6>]</span> Error <span style=color:#bd93f9>2</span>
</span></span></code></pre></div><blockquote><p>问题原因：<code>CFLGS</code>中也是用了引号""，使用了两次引号，出现以下错误。</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>$(</span>MAKE<span style=color:#ff79c6>)</span> <span style=color:#8be9fd;font-style:italic>KCPPFLAGS</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;</span><span style=color:#ff79c6>$(</span>CFLGS<span style=color:#ff79c6>)</span><span style=color:#f1fa8c>&#34;</span> <span style=color:#8be9fd;font-style:italic>ARCH</span><span style=color:#ff79c6>=</span>arm64 <span style=color:#8be9fd;font-style:italic>CROSS_COMPILE</span><span style=color:#ff79c6>=</span><span style=color:#ff79c6>$(</span>TOOLCHAIN<span style=color:#ff79c6>)</span>/aarch64-fsl-linux- -C <span style=color:#ff79c6>$(</span>KERNELDIR<span style=color:#ff79c6>)</span>  <span style=color:#8be9fd;font-style:italic>M</span><span style=color:#ff79c6>=</span><span style=color:#ff79c6>$(</span>PWD<span style=color:#ff79c6>)</span> modules
</span></span></code></pre></div><h3 id=编译应用出错>编译应用出错
<a class=heading-link href=#%e7%bc%96%e8%af%91%e5%ba%94%e7%94%a8%e5%87%ba%e9%94%99><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>root@ubuntu:/home/yocto/hedong/s32v234_sdk/demos/isp/isp_sonyimx224_csi_dcu/build-v234ce-gnu-linux-o# make
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>Current SDK ROOT is /home/yocto/hedong/s32v234_sdk
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>.C0_headdep.mk: updating main-cpp.C0.d
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>/bin/bash: aarch64-linux-gnu-g++: <span style=color:#8be9fd;font-style:italic>command</span> not found
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>  arm64/gnu/debug CX main-cpp.o
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>/bin/bash: aarch64-linux-gnu-g++: <span style=color:#8be9fd;font-style:italic>command</span> not found
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>make: *** <span style=color:#ff79c6>[</span>main-cpp.o<span style=color:#ff79c6>]</span> Error <span style=color:#bd93f9>1</span>
</span></span></code></pre></div><blockquote><p>问题原因：没有将交叉编译工具链的路径添加到PATH环境中去。</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#6272a4># aarch64-fsl-linux</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>TOOLCHAIN</span><span style=color:#ff79c6>=</span>/home/yocto/hedong/SourceCode/baolong-sourcecode/baolong4_1_26/BSP_12.0/Yocto_s32v234_bsp12.0/build_s32v234evb_release/tmp/sysroots/x86_64-linux/usr/bin/aarch64-fsl-linux
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#6272a4># aarch64-linux-gnu</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>TOOLCHAIN</span><span style=color:#ff79c6>=</span>/home/yocto/zhaolong/baolong-sourcecode/baolong4_1_26/crossing_compiler/gcc-linaro-4.9-2014.11-x86_64_aarch64-linux-gnu/bin
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#6272a4># 最后导入环境变量</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>PATH</span><span style=color:#ff79c6>=</span><span style=color:#8be9fd;font-style:italic>$TOOLCHAIN</span>:<span style=color:#8be9fd;font-style:italic>$PATH</span>
</span></span></code></pre></div><h3 id=内核文件校验问题>内核文件校验问题
<a class=heading-link href=#%e5%86%85%e6%a0%b8%e6%96%87%e4%bb%b6%e6%a0%a1%e9%aa%8c%e9%97%ae%e9%a2%98><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>[</span>    0.000000<span style=color:#ff79c6>]</span> Linux version 4.1.26-rt29+gfc72c8d <span style=color:#ff79c6>(</span>ubuntu@ubuntu<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>(</span>gcc version 4.9.3 <span style=color:#bd93f9>20150311</span> <span style=color:#ff79c6>(</span>prerelease<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>(</span>Linaro GCC 4.9-2015.03<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>)</span> <span style=color:#6272a4>#2 SMP PREEMPT Mon Jun 19 12:03:22 CST 2017</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#ff79c6>[</span>    0.000000<span style=color:#ff79c6>]</span> Linux version 4.1.26-rt29 <span style=color:#ff79c6>(</span>b46809@ulm<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>(</span>gcc version 4.9.3 <span style=color:#bd93f9>20150413</span> <span style=color:#ff79c6>(</span>prerelease<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>(</span>Linaro GCC 4.9-2015.05<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>)</span> <span style=color:#6272a4>#1 SMP PREEMPT Wed Apr 12 20:47:45 CEST 2017</span>
</span></span></code></pre></div><blockquote><p><code>gfc72c8d</code>内核后缀会导致驱动加载兼容性问题。</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>root@ubuntu:.../kernel-source# grep -rn <span style=color:#f1fa8c>&#34;gfc72c8d&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>Binary file .tmp_vmlinux2 matches
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>Binary file .tmp_vmlinux1 matches
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>Binary file vmlinux.o matches
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>Binary file init/built-in.o matches
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>Binary file init/version.o matches
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>Binary file vmlinux matches
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>Binary file kernel/sys.o matches
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>Binary file kernel/module.o matches
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>Binary file kernel/built-in.o matches
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>include/config/kernel.release:1:4.1.26-rt29+gfc72c8d
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>include/generated/utsrelease.h:1:#define UTS_RELEASE <span style=color:#f1fa8c>&#34;4.1.26-rt29+gfc72c8d&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>Binary file drivers/built-in.o matches
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>Binary file drivers/base/firmware_class.o matches
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>Binary file drivers/base/built-in.o matches
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>Binary file arch/arm64/boot/Image matches
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>.scmversion:1:+gfc72c8d	<span style=color:#6272a4># 由于这个文件添的校验，修改此处为空或者缺少此文件会产生&#34;-dirty&#34;的后缀。</span>
</span></span></code></pre></div><p>如带<code>-dirty</code>的后缀：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#6272a4>#define UTS_RELEASE &#34;4.1.26-rt29-dirty&#34;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>root@ubuntu:.../kernel-source# grep -rn ./scripts/setlocalversion 
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>Makefile:951:	<span style=color:#8be9fd;font-style:italic>echo</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#ff79c6>$(</span>KERNELVERSION<span style=color:#ff79c6>)</span><span style=color:#8be9fd;font-style:italic>$$</span><span style=color:#f1fa8c>(</span><span style=color:#ff79c6>$(</span>CONFIG_SHELL<span style=color:#ff79c6>)</span><span style=color:#f1fa8c> </span><span style=color:#ff79c6>$(</span>srctree<span style=color:#ff79c6>)</span><span style=color:#f1fa8c>/scripts/setlocalversion </span><span style=color:#ff79c6>$(</span>srctree<span style=color:#ff79c6>)</span><span style=color:#f1fa8c>)&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>Makefile:1491:	@echo <span style=color:#f1fa8c>&#34;</span><span style=color:#ff79c6>$(</span>KERNELVERSION<span style=color:#ff79c6>)</span><span style=color:#8be9fd;font-style:italic>$$</span><span style=color:#f1fa8c>(</span><span style=color:#ff79c6>$(</span>CONFIG_SHELL<span style=color:#ff79c6>)</span><span style=color:#f1fa8c> </span><span style=color:#ff79c6>$(</span>srctree<span style=color:#ff79c6>)</span><span style=color:#f1fa8c>/scripts/setlocalversion </span><span style=color:#ff79c6>$(</span>srctree<span style=color:#ff79c6>)</span><span style=color:#f1fa8c>)&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>scripts/package/Makefile:48:	<span style=color:#ff79c6>$(</span>CONFIG_SHELL<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>$(</span>srctree<span style=color:#ff79c6>)</span>/scripts/setlocalversion --save-scmversion
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>vi ./scripts/setlocalversion  +80
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>	<span style=color:#6272a4># Check for uncommitted changes</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>	<span style=color:#ff79c6>if</span> git diff-index --name-only HEAD | grep -qv <span style=color:#f1fa8c>&#34;^scripts/package&#34;</span>; <span style=color:#ff79c6>then</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>			<span style=color:#8be9fd;font-style:italic>printf</span> <span style=color:#f1fa8c>&#39;%s&#39;</span> -dirty
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>			<span style=color:#6272a4>#printf &#39;%s&#39; -test</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>	<span style=color:#ff79c6>fi</span>
</span></span></code></pre></div><blockquote><p>该文件中“printf”与“echo”打印的数据都会体现在“UTS_RELEASE”中。</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>include/generated/utsrelease.h:1:#define UTS_RELEASE <span style=color:#f1fa8c>&#34;4.1.26-rt29+gfc72c8d&#34;</span>
</span></span></code></pre></div><blockquote><p>驱动的加载与<code>UTS_RELEASE</code>宏有关，直接修改include/linux/utsrelease.h文件的版本宏，驱动可正常加载。</p></blockquote><h3 id=编写驱动加载脚本>编写驱动加载脚本
<a class=heading-link href=#%e7%bc%96%e5%86%99%e9%a9%b1%e5%8a%a8%e5%8a%a0%e8%bd%bd%e8%84%9a%e6%9c%ac><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>vi insmod.sh
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>insmod /modules/sram.ko
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>insmod /modules/viulite.ko
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>insmod /modules/jpegdcd.ko
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>insmod /modules/h264dcd.ko
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>insmod /modules/oal_cma.ko
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>insmod /modules/csi.ko
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>insmod /modules/cam.ko
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>insmod /modules/seq.ko
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>insmod /modules/fdma.ko
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>insmod /modules/h264enc.ko
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>insmod /modules/galcore.ko <span style=color:#8be9fd;font-style:italic>contiguousSize</span><span style=color:#ff79c6>=</span>0x2000000
</span></span></code></pre></div><blockquote><p>将<code>insmod.sh</code>脚本写到<code>/etc/init.d/rcS</code> 文件中。</p></blockquote><h3 id=其他说明>其他说明
<a class=heading-link href=#%e5%85%b6%e4%bb%96%e8%af%b4%e6%98%8e><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><blockquote><p>您反馈的问题应该是Yocto中linaro的gcc工具链路径失效了，最新的Linux BSP（0）版本中修复了这个问题，
请您通过以下链接下载最新的Linux BSP，Yocto，以及相关文档：
<a href="http://www.nxp.com/webapp/swlicensing/sso/downloadSoftware.sp?catid=SW32XX-LINUXBSP01D">http://www.nxp.com/webapp/swlicensing/sso/downloadSoftware.sp?catid=SW32XX-LINUXBSP01D</a>
您可能需要注册一个NXP账号来申请Linux BSP的下载权限。</p><ol start=2><li>Linux的编译有两种方式：通过Yocto编译；配置工具链手动编译。在第二种情况下，用到的工具链和编译VSDK中的demo所需的工具链是一样的。
Yocto编译出来的Linux只是基本的OS，一些外设的驱动源码在VSDK中，另外一些demo工程也可以参考SDK中的例子。
所以，您可以利用Yocto来编译Linux，用VSDK来编译可能用到的驱动和开发应用程序。</li></ol></blockquote></div><footer><section class=see-also><h3 id=see-also-in-kernel>See also in kernel
<a class=heading-link href=#see-also-in-kernel><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><nav><ul><li><a href=/posts/206/>s32v启动日志分析</a></li></ul></nav></section><div class=comments><script>let getTheme=window.localStorage&&window.localStorage.getItem("colorscheme");getTheme=getTheme??"preferred-color-scheme";let theme=getTheme==="dark"?"github-dark":"github-light",s=document.createElement("script");s.src="https://utteranc.es/client.js",s.setAttribute("repo","shuiyuehd/blog-comment"),s.setAttribute("issue-term","pathname"),s.setAttribute("theme",theme),s.setAttribute("crossorigin","anonymous"),s.setAttribute("async",""),document.querySelector("div.comments").innerHTML="",document.querySelector("div.comments").appendChild(s)</script></div></footer></article></section></div><footer class=footer><section class=container>©
2022
shuiyuehd
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=/js/coder.min.236049395dc3682fb2719640872958e12f1f24067bb09c327b233e6290c7edac.js integrity="sha256-I2BJOV3DaC+ycZZAhylY4S8fJAZ7sJwyeyM+YpDH7aw="></script></body></html>